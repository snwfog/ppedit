// Generated by CoffeeScript 1.6.3
(function() {
  var Box, Controller, CreateBoxCommand, EditorManager, ICommand, MoveBoxCommand,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  ICommand = (function() {
    function ICommand(root) {
      this.root = root;
    }

    return ICommand;

  })();

  MoveBoxCommand = (function(_super) {
    __extends(MoveBoxCommand, _super);

    function MoveBoxCommand(box, newX, newY) {
      this.box = box;
      this.newX = newX;
      this.newY = newY;
      this.prevStyle = this.box.get(0).style;
    }

    MoveBoxCommand.prototype.execute = function() {
      return this.box.css({
        left: this.newX + 'px',
        top: this.newY + 'px'
      });
    };

    MoveBoxCommand.prototype.undo = function() {
      return this.box.css({
        left: this.prevStyle.left,
        top: this.prevStyle.top
      });
    };

    return MoveBoxCommand;

  })(ICommand);

  Box = (function() {
    function Box(options) {
      var settings,
        _this = this;
      this.mouseDown = false;
      settings = $.extend({
        left: '50px',
        top: '50px',
        width: '100px',
        height: '200px'
      }, options);
      this.element = $('<div></div>').addClass('ppedit-box').attr('id', $.now()).css(settings).mousedown(function() {
        return _this.mouseDown = true;
      });
    }

    return Box;

  })();

  CreateBoxCommand = (function(_super) {
    __extends(CreateBoxCommand, _super);

    function CreateBoxCommand(root, options) {
      this.root = root;
      this.options = options;
      CreateBoxCommand.__super__.constructor.call(this, this.root);
      this.box = null;
    }

    CreateBoxCommand.prototype.execute = function() {
      this.box = new Box(this.options);
      return this.root.append(this.box.element);
    };

    CreateBoxCommand.prototype.undo = function() {
      return this.root.remove(this.box.element);
    };

    return CreateBoxCommand;

  })(ICommand);

  EditorManager = (function() {
    function EditorManager(root) {
      this.root = root;
      this.undoStack = [];
      this.redoStack = [];
      this.boxes = [];
      this.prevMousePosition = void 0;
      this.build();
    }

    EditorManager.prototype.build = function() {
      var _this = this;
      return this.root.addClass("ppedit-container").mousemove(function(event) {
        var box, _fn, _i, _len, _ref;
        _ref = _this.boxes;
        _fn = function(box) {
          var currentPos, delta;
          console.log(box.mouseDown);
          if (box.mouseDown && (_this.prevMousePosition != null)) {
            delta = {
              x: event.clientX - _this.prevMousePosition.x,
              y: event.clientY - _this.prevMousePosition.y
            };
            currentPos = {
              x: parseInt(box.element.css('left')),
              y: parseInt(box.element.css('top'))
            };
            box.element.css('left', (delta.x + currentPos.x) + 'px');
            return box.element.css('top', (delta.y + currentPos.y) + 'px');
          }
        };
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          box = _ref[_i];
          _fn(box);
        }
        return _this.prevMousePosition = {
          x: event.clientX,
          y: event.clientY
        };
      }).mouseup(function() {
        var box, _i, _len, _ref;
        _ref = _this.boxes;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          box = _ref[_i];
          box.mouseDown = false;
        }
        return _this.prevMousePosition = void 0;
      });
    };

    EditorManager.prototype.createBox = function(options) {
      var command;
      command = new CreateBoxCommand(this.root, options);
      this.pushCommand(command);
      return this.boxes.push(command.box);
    };

    EditorManager.prototype.moveBox = function(box, newX, newY) {
      return this.pushCommand(new MoveBoxCommand(box, newX, newY));
    };

    EditorManager.prototype.pushCommand = function(command) {
      command.execute();
      return this.undoStack.push(command);
    };

    EditorManager.prototype.undo = function() {
      var lastExecutedCommand;
      if (this.undoStack.length > 0) {
        lastExecutedCommand = this.undoStack.pop;
        lastExecutedCommand.undo();
        return this.redoStack.push(lastExecutedCommand);
      }
    };

    EditorManager.prototype.redo = function() {
      if (this.redoStack.length > 0) {
        return this.pushCommand(this.redoStack.pop);
      }
    };

    return EditorManager;

  })();

  Controller = (function() {
    function Controller(root) {
      this.root = root;
      this.editorManager = new EditorManager(this.root);
    }

    Controller.prototype.start = function() {
      var createBoxbutton,
        _this = this;
      createBoxbutton = $("<button>Create Box</button>");
      this.root.append(createBoxbutton);
      return createBoxbutton.click(function() {
        return _this.editorManager.createBox();
      });
    };

    return Controller;

  })();

  /*
  FooBar jQuery Plugin v1.0 - It makes Foo as easy as coding Bar (?).
  Release: 19/04/2013
  Author: Joe Average <joe@average.me>
  
  http://github.com/joeaverage/foobar
  
  Licensed under the WTFPL license: http://www.wtfpl.net/txt/copying/
  */


  (function($, window, document) {
    var $this, methods, _anotherState, _flag, _internals, _settings;
    $this = void 0;
    _settings = {
      "default": 'cool!'
    };
    _flag = false;
    _anotherState = null;
    methods = {
      init: function(options) {
        var controller;
        $this = $(this);
        $.extend(_settings, options || {});
        controller = new Controller($this);
        controller.start();
        return $this;
      },
      doSomething: function(what) {
        return $this;
      },
      destroy: function() {
        return $this;
      }
    };
    _internals = {
      toggleFlag: function() {
        return _flag = !_flag;
      }
    };
    return $.fn.ppedit = function(method) {
      if (methods[method]) {
        return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
      } else if (typeof method === "object" || !method) {
        return methods.init.apply(this, arguments);
      } else {
        return $.error("Method " + method + " does not exist on jquery.ppedit");
      }
    };
  })(jQuery, window, document);

}).call(this);
